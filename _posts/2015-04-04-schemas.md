---
layout: post
title:  "Schema Guide"
---


Schemas are the centerpoint of the FSSI File Processor. They contain all of the business rules for the validator organizer functions which are the meat and potatoes of the whole system.

At runtime, Schemas are loaded into the system. Then, when a source file is being processed, if a schema is associated (via Provider object), it is personalized and then binded to the source file object. This allows the FSSI File Processor to be more flexible in 

leveraging the principles of [CSV Lint](http://csvlint.io) and based upon the [JSON Table Schema RFC](http://dataprotocols.org/json-table-schema/), The FSSI File Processor Schemas are written in [XML](http://en.wikipedia.org/wiki/XML).

##Features
Here are some of the things that set our schemas and validation process apart from other tools and services:

1. **Multiple Error Levels**: Constraints and Types can be configured to fail as a Warning, Error, or Fatal. This helps teams better define which issues are imporant. 
2. **Effective Date Based Validations**: As business rules change for providers over time, your schemas can too. Constraints can be configured with effective dates that will actually tailor the schema at runtime to only enforce validations relevant to that file.
3. **Alias' and Field Name Mappings**: Sometimes, field names change over time. In other scenarios, different providers call the same field 2 different things. With Alias', you can actually create a data dictionary that will map fields to the correct field.

##Basic Structure of a Schema

{% highlight XML %}
<schema>
 	<fields>
 		<field>
 			<!-- Field 1 -->
 			<constraints>
 				<constraint_name><!-- Constraint 1 --></constraint_name>
 				<constraint_name><!-- Constraint n --></constraint_name>
				</constraints>
			</field>
 		<field><!-- Field 2 --></field>
 		<field><!-- Field 3 --></field>
 		<field><!-- Field n --></field>
 		etc...
 	</fields>
</schema>    
{% endhighlight %} 			   			


As you can see, there is a parent->child relationship between the schemas, fields, and constraints objects. There is no limit as to the number of fields a schema can have, nor the number of constraints a field can have.


##Schema Attributes
---
The schema consists of the following top level elements:

###Name (**Required**)

Schemas are linked to source files by their name, which is documented in the provider file. Schema names should be unique. If 2 schemas have the same name, the FSSI-File-Processor will ignore the second. Name is a **required** field.

{% highlight XML %}
<name>example_schema</name>
{% endhighlight %} 	

###Provider

In prior versions of the FSSI File Processor, providers and schemas were loosly coupled. After some thought, it made sense to not depend upon this field to physically map a schema to a provider. This is still, however, a valid field that could be useful for documentation purposes.

{% highlight XML %}
<provider>example_provider</provider>
{% endhighlight %} 	


###Version
This is a user defined field. The system does not currently leverage it. This is still, however, a valid field that could be useful for documentation purposes.

{% highlight XML %}
<version>1.0</version>
{% endhighlight %} 	


###Title
This is a user defined field. The system does not currently leverage it. This is still, however, a valid field that could be useful for documentation purposes.

{% highlight XML %}
	<title>1.0</title>
{% endhighlight %} 	


###Fields
Fields defines all of the field objects within the schema. Please see the "Field Attributes" section for more information. Fields are **required**.


{% highlight XML %}
<fields>
	<field>
		<name>field 1</name>
	</field>
	<field>
		<name>field 2</name>		
	</field>
</fields>
{% endhighlight %} 


##Field Attributes
---

			<description>Each order should be identified by a unique order identification number</description>
			<constraints>
				<required level="error">true</required>
				<maxLength level="error">30</maxLength>
			</constraints>
			<alias>Ord_Num</alias>


###Name - **Required**
This is the standard or dictionary name for the field. Used for mapping to the source file as well as outputting to a staged file. Though the system does not enforce strict naming standards, it behooves the user to develop a consistant naming convention amongst fields. This is a **Required** field.


{% highlight XML %}
<name>PRODUCT_DESCRIPTION</name>
{% endhighlight %} 	



###Title
This is the informal or long name for the field. Used for mapping to the source file as well as outputting to a staged file. The system does not currently leverage this field. This is still, however, a valid field that could be useful for documentation purposes.

{% highlight XML %}
<title>Product Description</title>
{% endhighlight %} 	



###Description
This is a user defined field. The system does not currently leverage this field. This is still, however, a valid field that could be useful for documentation purposes.

{% highlight XML %}
<description>Description of the product as provided by the supplier.</description>
{% endhighlight %} 	


###Alias
Alias' are used to map variations and permutations of field names to a standard field name. If you have a provider that sends files with little tweaks and difference in the field names, you can use Alias' to map them all to the standard Name.


{% highlight XML %}
<alias>agn_code</alias>
{% endhighlight %} 	


####A more practical usage of Alias can be seen below:

{% highlight XML %}
<field>
	<!-- First we have our standard field name -->
	<name>AGENCY_CODE</name>
	<!-- now we put in a list of alias' that map to that standard field name. -->
	<alias>agn_code</alias>
	<alias>agency_dc</alias>
	<alias>agency code</alias>
	...etc
</field>		
{% endhighlight %} 	

Anytime a file had a field with a permutation (agn_code, agency_cd, agency code), it would map to the AGENCY_CODE standard name.

**NOTE: If 2 fields have the same alias', the FSSI File Processor will only use the first one.**


###Type
A fieldâ€™s type attribute is a string indicating the data type of this field.

The Type field is **Optional**. If a type is not defined, then the type is defaulted to **any** (AKA **string**). Additionally, if type is not defined, format ignored.

The system recognizes the following data types.


####Any
Default format when another is not applied.

{% highlight XML %}
<type>any</type>
{% endhighlight %} 	


####String
A string (of arbitrary length). Example: "Hello World"


{% highlight XML %}
<type>string</type>
{% endhighlight %} 	


####Number
A number including floating point numbers. Example: 123456.99


{% highlight XML %}
<type>number</type>
{% endhighlight %} 	


####Integer
An integer. No floating point numbers. If floating points are provided, this will fail validation. Example: 123456.


{% highlight XML %}
<type>integer</type>
{% endhighlight %} 	


####Date
a date. This MUST be in ISO6801 format "YYYY-MM-DD" or, if not, a format field must be provided describing the structure. Date validation is strict and format should be based upon [Joda Time Format](http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html). Example: 2014-02-28

**NOTE: There is currently an ancillary type validation in place that will fail records that are + or - 50 years from system date. This was designed to compensate for ussues related to poorly designed date formats that don't have a separator.**


{% highlight XML %}
<type>date</type>
{% endhighlight %} 


####A more practical usage of the Date Type can be seen below:

{% highlight XML %}
<field>
	<name>AGENCY_CODE</name>
	<!-- First, we define the type -->
	<type>date</type>
	<!-- Now we define the format.  -->
	<type>yyyy-MM-dd</type>
</field>		
{% endhighlight %} 	


##Example Schemas
Example schemas can be found in the [samplefiles/schema folder](https://github.com/GSA/fssi-file-processor/tree/master/samplefiles/schemas) in Github. 



##XSD
When creating your schema, we highly recommend performing XSD Schema Validation (which can be easily done through a website like [http://www.xmlvalidation.com/](http://www.xmlvalidation.com/)). The current version of the FSSI File Processor XSD can be found here: [https://github.com/GSA/fssi-file-processor/blob/master/src/main/resources/schema.xsd](https://github.com/GSA/fssi-file-processor/blob/master/src/main/resources/schema.xsd).

This will allow you to quickly root out issues with the schema.


